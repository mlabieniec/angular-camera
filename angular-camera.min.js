/**
 * @license jQuery webcam plugin v1.0 09/12/2010
 * http://www.xarg.org/project/jquery-webcam-plugin/
 *
 * Copyright (c) 2010, Robert Eisele (robert@xarg.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/
!function(e){var t={extern:null,append:!1,width:320,height:240,mode:"callback",swffile:"jscam.swf",quality:85,debug:function(){},onCapture:function(){},onTick:function(){},onSave:function(){},onLoad:function(){}}
window.webcam=t,e.fn.webcam=function(n){if("object"==typeof n)for(var r in t)void 0!==n[r]&&(t[r]=n[r])
var i='<object id="XwebcamXobjectX" type="application/x-shockwave-flash" data="'+t.swffile+'" width="'+t.width+'" height="'+t.height+'"><param name="movie" value="'+t.swffile+'" /><param name="FlashVars" value="mode='+t.mode+"&amp;quality="+t.quality+'" /><param name="allowScriptAccess" value="always" /></object>'
null!==t.extern?e(t.extern)[t.append?"append":"html"](i):this[t.append?"append":"html"](i),(_register=function(e){var n=document.getElementById("XwebcamXobjectX")
void 0!==n.capture?(t.capture=function(e){try{return n.capture(e)}catch(t){}},t.save=function(e){try{return n.save(e)}catch(t){}},t.setCamera=function(e){try{return n.setCamera(e)}catch(t){}},t.getCameraList=function(){try{return n.getCameraList()}catch(e){}},t.onLoad()):0==e?t.debug("error","Flash movie not yet registered!"):window.setTimeout(_register,1e3*(4-e),e-1)})(3)}}(jQuery),function(e,t){"use strict"
var n,r,i,o,a,s,c,u,l,f=[],d=[]
a={containerRegistration:"hilary::container",parentContainerRegistration:"hilary::parent",singletons:"__singletons",notResolvable:"hilary::handler::not::resolvable",pipeline:{beforeRegister:"hilary::before::register",afterRegister:"hilary::after::register",beforeResolve:"hilary::before::resolve",afterResolve:"hilary::after::resolve",beforeNewChild:"hilary::before::new::child",afterNewChild:"hilary::after::new::child",onError:"hilary::error"}},s=function(){var e,t,n={},r=Object.prototype,i=r.toString,o=(r.hasOwnProperty,{}),a=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"]
for(e=0;e<a.length;e+=1)t=a[e],o["[object "+t+"]"]=t.toLowerCase()
return n.type=function(e){return"undefined"==typeof e?"undefined":null===e?String(e):"object"==typeof e||"function"==typeof e?o[i.call(e)]||"object":typeof e},n.notDefined=function(e){try{return"undefined"===this.type(e)}catch(t){return!0}},n.isDefined=function(e){try{return"undefined"!==this.type(e)}catch(t){return!1}},n.isFunction=function(e){return"function"===this.type(e)},n.notFunction=function(e){return"function"!==this.type(e)},n.isObject=function(e){return"object"===this.type(e)},n.notObject=function(e){return"object"!==this.type(e)},n.isArray=function(e){return"array"===this.type(e)},n.notArray=function(e){return"array"!==this.type(e)},n.isString=function(e){return"string"===this.type(e)},n.notString=function(e){return"string"!==this.type(e)},n.isBoolean=function(e){return"boolean"===this.type(e)},n.notBoolean=function(e){return"boolean"!==this.type(e)},n.notNullOrWhitespace=function(e){if(!e)return!1
if(this.notString(e))throw new Error("Unable to check if a non-string is whitespace.")
return/([^\s])/.test(e)},n.isNullOrWhitespace=function(e){return this.notNullOrWhitespace(e)===!1},n.createGuid=function(){return"zxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8
return n.toString(16)})},n},c=new s,u=function(e,t){var n,r={}
return n=function(n,r,i){var o=e.isString(r)?r:n,a=new Error(o)
return a.message=o,n!==o&&(a.name=n),i&&(a.data=i),t.onError(a),a},r.makeException=n,r.argumentException=function(t,r,i){var o=e.notDefined(r)?t:t+" (argument: "+r+")"
return n("ArgumentException",o,i)},r.dependencyException=function(t,r,i){var o=e.notDefined(r)?t:t+" (dependency: "+r+"). If the module exists, does it return a value?"
return n("DependencyException",o,i)},r.notImplementedException=function(e,t){return n("NotImplementedException",e,t)},r.notResolvableException=function(e){return r.dependencyException("The module cannot be resolved",e)},r},i=function(){var e={}
return e.beforeRegisterEvents=[],e.afterRegisterEvents=[],e.beforeResolveEvents=[],e.afterResolveEvents=[],e.beforeNewChildEvents=[],e.afterNewChildEvents=[],e.onError=[],e},o=function(e,t){var n,r,o,s,c,u,l,f,d,p={},y=new i
return n=function(t,n){switch(t){case a.pipeline.beforeRegister:return y.beforeRegisterEvents.push(n),e
case a.pipeline.afterRegister:return y.afterRegisterEvents.push(n),e
case a.pipeline.beforeResolve:return y.beforeResolveEvents.push(n),e
case a.pipeline.afterResolve:return y.afterResolveEvents.push(n),e
case a.pipeline.beforeNewChild:return y.beforeNewChildEvents.push(n),e
case a.pipeline.afterNewChild:return y.afterNewChildEvents.push(n),e
case a.pipeline.onError:return y.onError.push(n),e
default:throw new Error("the pipeline event you are trying to register is not implemented (name: "+t+")")}},r=function(e,n){var r,i
for(r=0;r<e.length;r+=1)i=e[r],i.once&&e.splice(r,1),t.isFunction(i)&&i.apply(null,n)},o=function(t){r(p.events.beforeRegisterEvents,[e,t])},s=function(t){r(p.events.afterRegisterEvents,[e,t])},c=function(t){r(p.events.beforeResolveEvents,[e,t])},u=function(t){r(p.events.afterResolveEvents,[e,t])},l=function(t){r(p.events.beforeNewChildEvents,[e,t])},f=function(t,n){r(p.events.afterNewChildEvents,[e,t,n])},d=function(e){r(p.events.onError,[e])},p.events=y,p.registerEvent=n,p.onError=d,p.beforeRegister=o,p.afterRegister=s,p.beforeResolve=c,p.afterResolve=u,p.beforeNewChild=l,p.afterNewChild=f,p},r=function(r,i,o,s,u){var f={}
return f.HilaryModule=function(e){var t={}
if(c.notString(e.name))throw u.argumentException("The module name is required","name")
if(c.notDefined(e.factory))throw u.argumentException("The module factory is required","factory")
return t.name=e.name,t.dependencies=e.dependencies||void 0,t.factory=e.factory,t},f.asyncHandler=function(e,t){var n=function(){var n
try{n=e()}catch(r){return void(c.isFunction(t)&&t(r))}c.isFunction(t)&&t(null,n)}
l?l.nextTick(n):setTimeout&&setTimeout(n,0)},f.createChildContainer=function(e,t,r){t=t||{}
var i,a
return i={parentContainer:e},o.beforeNewChild(i),a=new n(i),e.registerAsync&&a.useAsync(l),o.afterNewChild(i,a),a},f.register=function(e){if(o.beforeRegister(e),e.name===a.containerRegistration||e.name===a.parentContainerRegistration)throw u.argumentException("The name you are trying to register is reserved","moduleName",e.name)
return i[e.name]=e,f.asyncHandler(function(){o.afterRegister(e)}),e},f.resolve=function(e){var t,n
if(c.notString(e))throw u.argumentException("The moduleName must be a string. If you are trying to resolve an array, use resolveMany.","moduleName")
if(o.beforeResolve(e),t=i[e],void 0!==t)return n=f.invoke(t),f.returnResult({name:e,result:n},o)
if(n=f.findResult(e))return f.returnResult({name:e,result:n},o)
throw u.notResolvableException(e)},f.resolveMany=function(e,t){var n,i,o=[]
if(c.notArray(e))throw u.argumentException("The moduleNameArray is required and must be an Array","moduleNameArray")
if(c.notFunction(t))throw u.argumentException("The next argument is required and must be a Function","next")
for(n=0;n<e.length;n+=1)try{i=r.resolve(e[n]),o.push(i)}catch(a){o.push(a)}return t.apply(null,o)},f.resolveManyAsync=function(e,t){var n,i=[],o={},a=function(e){return function(t){try{o[e]=r.resolve(e),t(null,null)}catch(n){t(n)}}}
if(c.notArray(e))throw u.argumentException("The moduleNameArray is required and must be an Array","moduleNameArray")
if(c.notFunction(t))throw u.argumentException("The next argument is required and must be a Function","next")
for(n=0;n<e.length;n+=1)i.push(a(e[n]))
l.parallel(i,function(e,n){t(e,o)})},f.resolveAsync=function(e,t){var n,r,a,s,d
n=function(t){c.notString(e)?t(u.argumentException("The moduleName must be a string. If you are trying to resolve an array, use resolveManyAsync.","moduleName")):t(null,null)},r=function(t,n){n(null,o.beforeResolve(e))},a=function(t,n){var r
r=i[e],void 0!==r?f.invokeAsync(r,n):n(null,null)},s=function(t,n){t?n(null,t):n(null,f.findResult(e))},d=function(t,n){t?(o.afterResolve({name:e,result:t}),n(null,t)):n(u.notResolvableException(e))},l.waterfall([n,r,a,s,d],t)},f.findResult=function(n){if(n===a.containerRegistration)return i
if(n===a.parentContainerRegistration)return s.context.getContainer()
if(void 0!==s)return s.resolve(n)
if(t)try{return t(n)}catch(r){return null}else if(window)return e[n]},f.returnResult=function(e){return f.asyncHandler(function(){o.afterResolve(e)}),e.result},f.invoke=function(e){return c.isArray(e.dependencies)&&e.dependencies.length>0?f.applyDependencies(e):c.isFunction(e.factory)&&0===e.factory.length?e.factory.call():e.factory},f.invokeAsync=function(e,t){return c.isArray(e.dependencies)&&e.dependencies.length>0?void f.applyDependenciesAsync(e,t):void(c.isFunction(e.factory)&&0===e.factory.length?t(null,e.factory.call()):t(null,e.factory))},f.applyDependencies=function(e){var t,n=[],r=function(e){return f.resolve(e)}
for(t=0;t<e.dependencies.length;t+=1)n.push(r(e.dependencies[t]))
return e.factory.apply(null,n)},f.applyDependenciesAsync=function(e,t){var n,r=[],i=function(e){return function(t){f.resolveAsync(e,t)}}
for(n=0;n<e.dependencies.length;n+=1)r.push(i(e.dependencies[n]))
l.parallel(r,function(n,r){t(null,e.factory.apply(null,r))})},f.makeAutoRegistrationTasks=function(e,t){var n,r,i=[]
if(c.isObject(e)&&(e.name||e.dependencies||e.factory))i.push(function(){t(e).call()})
else if(c.isObject(e))for(n in e)e.hasOwnProperty(n)&&i.push(t(e[n]))
else{if(!c.isArray(e))throw u.argumentException("A index must be defined and must be a typeof object or array","index")
for(r=0;r<e.length;r+=1)i.push(t(e[r]))}return i},f.autoRegister=function(e,t){var n,r,i
n=function(e){return function(){f.register(e)}}
try{for(r=f.makeAutoRegistrationTasks(e,n),i=0;i<r.length;i+=1)r[i]()
c.isFunction(t)&&t(null)}catch(o){t(o)}},f.autoResolve=function(e,t){var n,i,o
n=function(e){return function(){c.isArray(e.dependencies)&&c.isFunction(e.factory)?r.resolveMany(e.dependencies,e.factory):c.isFunction(e.factory)&&0===e.factory.length&&e.factory()}}
try{for(i=f.makeAutoRegistrationTasks(e,n),o=0;o<i.length;o+=1)i[o]()
c.isFunction(t)&&t(null,null)}catch(a){t(a)}},f.autoResolveAsync=function(e,t){var n
n=function(e){return function(t){c.isArray(e.dependencies)&&c.isFunction(e.factory)?(r.resolveManyAsync(e.dependencies,e.factory),t(null,null)):c.isFunction(e.factory)&&0===e.factory.length?(e.factory(),t(null,null)):t(u.argumentException("One or more of the items in this index do not meet the requirements for resolution.","index",e))}},l.parallel(f.makeAutoRegistrationTasks(e,n),t)},f.dispose=function(e){var t,n,r
if(c.isString(e))return f.disposeOne(e)
if(c.isArray(e)){for(r=!0,n=0;n<e.length;n+=1)r=r&&f.disposeOne(e[n])
return r}if(e)return!1
r=!0
for(t in i)i.hasOwnProperty(t)&&(r=r&&f.disposeOne(t))
return r},f.disposeOne=function(e){return i[e]?(delete i[e],!0):!1},f.useAsync=function(e){if(!(e&&e.nextTick&&e.waterfall&&e.parallel))throw u.argumentException("The async library is required (https://www.npmjs.com/package/async)","async")
return l||(l=e),r.registerAsync=function(e,t){return f.asyncHandler(function(){return r.register(e)},t),r},r.autoRegisterAsync=function(e,t){var n
return n=function(e){return function(t){r.registerAsync(e,t)}},l.parallel(f.makeAutoRegistrationTasks(e,n),t),r},r.resolveAsync=function(e,t){return f.resolveAsync(e,t),r},r.resolveManyAsync=function(e,t){return f.resolveManyAsync(e,t),r},r.autoResolveAsync=function(e,t){return f.autoResolveAsync(e,t),r},r.disposeAsync=function(e,t){var n=t,i=e
return c.isFunction(e)&&(n=e,i=null),f.asyncHandler(function(){return r.dispose(i)},n),r},r.registerEventAsync=function(e,t,n){return f.asyncHandler(function(){return r.registerEvent(e,t)},n),r},r},f},n=function(e){var t=this,n=e||{},i={},s=n.parentContainer,l=n.pipeline||new o(t,c),p=new u(c,l),y={},h={},m=new r(t,i,l,s,p)
for(t.createChildContainer=function(e){return m.createChildContainer(t,e,n)},t.register=function(e){return m.register(new m.HilaryModule(e)),t},t.autoRegister=function(e,n){return m.autoRegister(e,n),t},t.resolve=function(e){return m.resolve(e)},t.resolveMany=function(e,t){return m.resolveMany(e,t)},t.autoResolve=function(e,n){return m.autoResolve(e,n),t},t.dispose=function(e){return m.dispose(e)},t.registerEvent=function(e,n){return l.registerEvent(e,n),t},t.useAsync=function(e){return m.useAsync(e),t},t.getContext=function(){return{container:i,parent:s,HilaryModule:m.HilaryModule,register:m.register,constants:a,utils:c,exceptionHandlers:p}},y.count=0;y.count<f.length;y.count+=1)y.current=f[y.count],c.isFunction(y.current.factory)?t[y.current.name]=y.current.factory(t):c.isDefined(y.current.factory)&&(t[y.current.name]=y.current.factory)
for(h.count=0;h.count<d.length;h.count+=1)h.current=d[h.count],c.isFunction(h.current)&&h.current(t,n)},n.extend=function(e,t){return f.push({name:e,factory:t}),!0},n.onInit=function(e){return d.push(e),!0},e.Hilary=n}("undefined"!=typeof module&&module.exports?module.exports:window,"undefined"!=typeof module&&module.exports?require:void 0),function(e){"use strict"
window.camCaptureContainer=new e}(window.Hilary),function(e,t){"use strict"
e.register({name:"ICamCaptureSettings",dependencies:[],factory:function(){return function(e){var n=this
t.getMedia=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia,n.webRtcAvailable=t.getMedia?!0:!1,n.flashRequired=!n.webRtcAvailable,n.forceFlash=e.forceFlash||!1,n.captureParameters={delay:{rtc:e.delay&&e.delay.rtc||100,flash:e.delay&&e.delay.flash||1},frames:{rtc:e.frames&&e.frames.rtc||50,flash:e.frames&&e.frames.flash||30}},n.relativeSwfLocation=e.relativeSwfLocation||"cam.swf",n.canvasWidth=e.canvasWidth||320,n.canvasHeight=e.canvasHeight||240,n.displayWidth=e.displayWidth||320,n.displayHeight=e.displayHeight||240,n.getNewCanvas=function(e,t){return'<canvas width="'+e+'" height="'+t+'"/>'},n.videoSelector=e.videoSelector,n.flashVideoSelector=e.flashVideoSelector,n.camAccessSuccess=e.camAccessSuccess||function(){},n.camAccessError=e.camAccessError||function(){}}}})}(window.camCaptureContainer,window.navigator),function(e){"use strict"
e.register({name:"ICamCapture",dependencies:[],factory:function(){return function(e){if("function"!=typeof e.ctor)throw new Error("Constructor required on an implementation")
if("function"!=typeof e.capture)throw new Error("capture method required on an implementation")
if("function"!=typeof e.captureBurst)throw new Error("captureBurst method required on an implementation")
if("function"!=typeof e.destroy)throw new Error("destroy method required on an implementation")
var t=e.ctor
return t.prototype.capture=e.capture,t.prototype.captureBurst=e.captureBurst,t.prototype.destroy=e.destroy,t}}})}(window.camCaptureContainer),function(e,t,n,r,i){"use strict"
e.register({name:"CamCaptureRtc",dependencies:["ICamCapture"],factory:function(e){var o={},a={}
return o.ctor=function(e){var r,i,o=this,s=t(e.videoSelector),c=s[0]
o.type="RTC",o.destroy(),o.settings=e,o.videoElem=c,s.css("width",e.displayWidth+"px"),s.css("height",e.displayHeight+"px"),r=function(t){if(a=t,n.mozGetUserMedia)c.src=window.URL.createObjectURL(t)
else{var r=window.URL||window.webkitURL
c.src=r.createObjectURL(t)}c.play(),e.camAccessSuccess&&"function"==typeof e.camAccessSuccess&&e.camAccessSuccess()},i=function(t){e.camAccessError&&"function"==typeof e.camAccessError&&e.camAccessError(t)},n.getMedia({video:!0,audio:!1},r,i)},o.capture=function(e){var n,r,i=this
r=t(t("<div/>").html(i.settings.getNewCanvas(i.settings.displayWidth,i.settings.displayHeight))).children()[0],r.getContext("2d").drawImage(i.videoElem,0,0,i.settings.displayWidth,i.settings.displayHeight),n=r.toDataURL("image/png"),e&&"function"==typeof e&&e(n)},o.captureBurst=function(e){var t,n=0,o=this,a=[]
t=r(function(){o.capture(function(e){a.push(e),n+=1}),n===o.settings.captureParameters.frames.rtc&&(i(t),e&&"function"==typeof e&&e(a))},o.settings.captureParameters.delay.rtc)},o.destroy=function(){a&&a.stop&&a.stop()},new e(o)}})}(window.camCaptureContainer,window.jQuery,window.navigator,window.setInterval,window.clearInterval),function(e,t,n,r,i,o){"use strict"
e.register({name:"CamCaptureFlash",dependencies:["ICamCapture"],factory:function(e){var n,a,s={}
return s.ctor=function(e){var r=this,i=0,s={}
r.type="FLASH",r.settings=e,n(s,e),t(e.flashVideoSelector).show(),t(e.flashVideoSelector).webcam({width:e.displayWidth,height:e.displayHeight,mode:"callback",swffile:e.relativeSwfLocation,onTick:function(){},onSave:function(t){var r,o,c=t.split(";"),u=s.image
for(o=0;o<e.displayWidth;o+=1)r=parseInt(c[o]),u.data[i+0]=r>>16&255,u.data[i+1]=r>>8&255,u.data[i+2]=255&r,u.data[i+3]=255,i+=4
i>=4*e.displayWidth*e.displayHeight&&(s.ctx.putImageData(u,0,0),a&&a(s.canvas.toDataURL("image/png")),n(s,e),i=0)},onCapture:function(){o.save()},debug:function(t,n){"notify"===t&&"Camera started"===n?e.camAccessSuccess():"notify"===t&&"Camera stopped"===n&&e.camAccessError()}})},s.capture=function(e){a=e,o.capture()},s.captureBurst=function(e){var t,n=0,o=this,a=[]
t=r(function(){o.capture(function(e){a.push(e),n+=1}),n===o.settings.captureParameters.frames.flash&&(i(t),e&&"function"==typeof e&&e(a))},o.settings.captureParameters.delay.flash)},s.destroy=function(){t(this.settings.flashVideoSelector).hide()},n=function(e,n){e.canvas=t(t("<div/>").html(n.getNewCanvas(n.displayWidth,n.displayHeight))).children()[0],e.ctx=e.canvas.getContext("2d"),e.image=e.ctx.getImageData(0,0,n.displayWidth,n.displayHeight)},new e(s)}})}(window.camCaptureContainer,window.jQuery,window.navigator,window.setInterval,window.clearInterval,window.webcam),function(e){"use strict"
e.register({name:"CamCapture",dependencies:["ICamCaptureSettings","CamCaptureRtc","CamCaptureFlash"],factory:function(e,t,n){return function(r){this.name="CamCapture"
var i=new e(r)
return i.forceFlash||i.flashRequired?new n(i):new t(i)}}})}(window.camCaptureContainer),function(e){"use strict"
window.CamCapture=e.resolve("CamCapture")}(window.camCaptureContainer),function(e,t){"use strict"
t.module("angular-camera",[]).directive("camera",function(){return{template:'<div><video class="webcam-live"></video><div class="webcam-flash"></div></div>',replace:!0,restrict:"E",scope:{onReady:"&",onCapture:"&",rtc:"=",options:"="},link:function(e,t,n){e.rtc=new CamCapture(e.options)}}})}(window,window.angular)
